[["recovery-likelihood.html", "Part 15 Recovery Likelihood 15.1 Set Up 15.2 Prepare Patch Data 15.3 Model Patch Recovery", " Part 15 Recovery Likelihood 15.1 Set Up 15.1.1 Libraries library(tidyverse) library(terra) library(sf) library(gridExtra) library(car) library(exactextractr) library(elevatr) library(rms) library(rempsyc) library(kableExtra) sf_use_s2(FALSE) 15.1.2 Import High-Severity Patches # fire list fire_list &lt;- c(&quot;Fire_7_1988&quot;,&quot;Fire_9_1988&quot;,&quot;Fire_10_1988&quot;,&quot;Fire_11_1988&quot;,&quot;Fire_12_1988&quot;,&quot;Fire_13_1988&quot;,&quot;Fire_14_1988&quot;,&quot;Fire_15_1988&quot;,&quot;Fire_16_1988&quot;,&quot;Fire_18_1988&quot;,&quot;Fire_19_1988&quot;,&quot;Fire_20_1988&quot;,&quot;Fire_22_1988&quot;,&quot;Fire_23_1988&quot;,&quot;Fire_25_1988&quot;,&quot;Fire_26_1988&quot;,&quot;Fire_28_1988&quot;,&quot;Fire_29_1988&quot;,&quot;Fire_31_1988&quot;,&quot;Fire_32_1989&quot;,&quot;Fire_33_1989&quot;,&quot;Fire_35_1989&quot;,&quot;Fire_38_1989&quot;,&quot;Fire_41_1989&quot;,&quot;Fire_42_1989&quot;,&quot;Fire_48_1990&quot;,&quot;Fire_49_1991&quot;,&quot;Fire_50_1991&quot;,&quot;Fire_51_1991&quot;,&quot;Fire_54_1991&quot;,&quot;Fire_1_1988&quot;,&quot;Fire_2_1988&quot;,&quot;Fire_3_1988&quot;,&quot;Fire_4_1988&quot;) # import high-severity patches patches &lt;- st_read(&quot;data/patches/highsev_patches.shp&quot;) %&gt;% mutate(Patch_ID = str_c(Fire_ID,&quot;-&quot;,1:n())) %&gt;% st_transform(crs = &quot;EPSG:4326&quot;) # set crs crs &lt;- crs(patches) 15.2 Prepare Patch Data 15.2.1 Calculate Percent Reforested # import and join patch fragmentation data patch_fragmentation &lt;- do.call(bind_rows,lapply(list.files(path = &quot;data/patch_fate/t0t9&quot;, pattern = &quot;t0t9&quot;, all.files=TRUE, full.names=TRUE),read_csv)) # calculate the proportion of area recolonized by conifers after 30 years patch_recovery &lt;- patch_fragmentation %&gt;% group_by(Patch_ID,t9_status) %&gt;% summarise(t0_area = mean(t0_area), t9_area = round(sum(t9_area),5))%&gt;% pivot_wider(values_from = t9_area,names_from=t9_status) %&gt;% rename(t9_area_unforested = 4, t9_area_forested = 3)%&gt;% replace(is.na(.), 0) %&gt;% mutate(perc_forested = t9_area_forested/(t0_area)) 15.2.2 Calculate Patch Area and Edge patch_metrics &lt;- patches %&gt;% dplyr::select(Fire_ID,Patch_ID,ptch_fr,ecoregn) %&gt;% st_transform(3488) %&gt;% mutate(patch_area = round(as.numeric(st_area(.))/10000,4), perim_m = as.numeric(round(st_length(st_cast(geometry,to = &quot;MULTILINESTRING&quot;)),4)), area_perim_rat = patch_area/perim_m) %&gt;% st_buffer(-100) %&gt;% mutate(core_area = round(as.numeric(st_area(.))/10000,4), perc_core = round(core_area / patch_area,5))%&gt;% st_drop_geometry() 15.2.3 Calculate Patch Climate # import terraclim climate data, 3 year means before fire event # for each patch, extract the mean value for each climate variable get_climate &lt;- function(var){ extracted_var &lt;- list.files(path = &quot;data/terraclim/&quot;, pattern = var, all.files=TRUE, full.names=TRUE) %&gt;% rast() %&gt;% mean() %&gt;% extract(.,patches %&gt;% st_transform(crs= crs(.)),fun = mean,weights = TRUE, exact = TRUE) %&gt;% dplyr::select(mean) colnames(extracted_var) &lt;- var return(extracted_var) } # list of climate variables climate_variables &lt;- c(&quot;def&quot;,&quot;pdsi&quot;,&quot;swe&quot;,&quot;ppt&quot;,&quot;pet&quot;,&quot;tmax&quot;,&quot;soil&quot;,&quot;vpd&quot;) # extract mean climate values for each patch and assign to patch ID climate_df &lt;- map(climate_variables,get_climate) patch_climate &lt;- do.call(cbind,climate_df) %&gt;% cbind(Patch_ID = patches$Patch_ID,.) 15.2.4 Calculate Latitude patch_latitude &lt;- patches %&gt;% mutate(latitude = st_coordinates(st_centroid(geometry))[,2]) %&gt;% dplyr:: select(Patch_ID, latitude) %&gt;% st_drop_geometry() 15.2.5 Calculate Topography extract_topo &lt;- function(fire_name){ print(paste0(&quot;Starting Fire &quot;,fire_name)) # filter the patches for this fire fire_patches &lt;- patches %&gt;% filter(Fire_ID==fire_name) %&gt;% st_transform(crs=4326) dem &lt;- get_elev_raster(fire_patches,z=11) aspect &lt;- terrain(dem, opt = &quot;aspect&quot;,unit = &quot;degrees&quot;) slope &lt;- terrain(dem,opt=&#39;slope&#39;, unit=&#39;degrees&#39;) ccaspect &lt;- cos(aspect) # get the mean topographic values for each patch in this fire extracted_elev &lt;- left_join(fire_patches, exact_extract(dem,fire_patches, append_cols = TRUE, max_cells_in_memory = 3e+08, fun = &quot;mean&quot;)) %&gt;% st_drop_geometry() %&gt;% rename(elevation = mean) %&gt;% dplyr::select(Patch_ID, elevation) extracted_aspect &lt;- left_join(fire_patches, exact_extract(ccaspect,fire_patches, append_cols = TRUE, max_cells_in_memory = 3e+08, fun = &quot;mean&quot;)) %&gt;% st_drop_geometry() %&gt;% rename(aspect = mean) %&gt;% dplyr::select(aspect) extracted_slope &lt;- left_join(fire_patches, exact_extract(slope,fire_patches, append_cols = TRUE, max_cells_in_memory = 3e+08, fun = &quot;mean&quot;)) %&gt;% st_drop_geometry() %&gt;% rename(slope = mean) %&gt;% dplyr::select(slope) extracted_data &lt;- cbind(extracted_elev,extracted_aspect,extracted_slope) # export return(extracted_data) } # map extraction function across all fires extracted_fires &lt;- map(fire_list,extract_topo) patch_topography &lt;- do.call(rbind,extracted_fires) 15.2.6 Join Patch Metrics and Recovery Data # combine all predictor datasets, set recovery threshold to 80% forested log_recovery &lt;- list(patch_metrics,patch_recovery,patch_latitude,patch_climate,patch_topography) %&gt;% reduce(full_join, by=&#39;Patch_ID&#39;) %&gt;% drop_na() %&gt;% filter(ptch_fr %in% c(&quot;Douglas-Fir&quot;,&quot;Lodegepole Pine&quot;,&quot;Fir-Spruce&quot;)) %&gt;% mutate(log_recovered = case_when(perc_forested &gt;= 0.8 ~ 1, perc_forested &lt; 0.8 ~ 0), area_perim_rat = area_perim_rat*10000, ecoregn = as.factor(ecoregn), ptch_fr= as.factor(ptch_fr)) %&gt;% st_drop_geometry() 15.3 Model Patch Recovery 15.3.1 Prepare Model Data # data prep required for lrm model dd &lt;- datadist(log_recovery) options(datadist=&quot;dd&quot;) 15.3.2 Create Logistic Model # logistic regression model with lrm log_model &lt;- lrm(log_recovered ~ ptch_fr + area_perim_rat + patch_area + elevation + slope + aspect + def + swe ,data = log_recovery) # lrm model object log_model ## Logistic Regression Model ## ## lrm(formula = log_recovered ~ ptch_fr + area_perim_rat + patch_area + ## elevation + slope + aspect + def + swe, data = log_recovery) ## ## Model Likelihood Discrimination Rank Discrim. ## Ratio Test Indexes Indexes ## Obs 3852 LR chi2 1690.54 R2 0.477 C 0.858 ## 0 1653 d.f. 9 R2(9,3852)0.354 Dxy 0.716 ## 1 2199 Pr(&gt; chi2) &lt;0.0001 R2(9,2831)0.448 gamma 0.716 ## max |deriv| 3e-06 Brier 0.147 tau-a 0.351 ## ## Coef S.E. Wald Z Pr(&gt;|Z|) ## Intercept 9.1804 0.7289 12.59 &lt;0.0001 ## ptch_fr=Fir-Spruce -0.7437 0.1708 -4.35 &lt;0.0001 ## ptch_fr=Lodegepole Pine 1.0070 0.1679 6.00 &lt;0.0001 ## area_perim_rat -0.0070 0.0019 -3.69 0.0002 ## patch_area -0.0001 0.0001 -1.55 0.1219 ## elevation -0.0031 0.0002 -15.13 &lt;0.0001 ## slope -0.0993 0.0069 -14.37 &lt;0.0001 ## aspect -0.1738 0.4785 -0.36 0.7164 ## def -0.0231 0.0113 -2.05 0.0404 ## swe 0.0066 0.0034 1.97 0.0491 #model summary odds ratio kable(summary(log_model,def = c(1,2),swe = c(1,2),area_perim_rat = c(1,2),patch_area = c(1,2),elevation = c(1,2),slope = c(1,2),aspect = c(1,2))) Low High Diff. Effect S.E. Lower 0.95 Upper 0.95 Type area_perim_rat 1 2 1 -0.0070126 0.0019007 -0.0107379 -0.0032874 1 Odds Ratio 1 2 1 0.9930119 NA 0.9893196 0.9967180 2 patch_area 1 2 1 -0.0001010 0.0000653 -0.0002290 0.0000270 1 Odds Ratio 1 2 1 0.9998990 NA 0.9997711 1.0000270 2 elevation 1 2 1 -0.0030972 0.0002047 -0.0034984 -0.0026960 1 Odds Ratio 1 2 1 0.9969076 NA 0.9965077 0.9973077 2 slope 1 2 1 -0.0992698 0.0069058 -0.1128050 -0.0857346 1 Odds Ratio 1 2 1 0.9054984 NA 0.8933249 0.9178378 2 aspect 1 2 1 -0.1737843 0.4784582 -1.1115452 0.7639766 1 Odds Ratio 1 2 1 0.8404781 NA 0.3290501 2.1467961 2 def 1 2 1 -0.0231220 0.0112818 -0.0452340 -0.0010101 1 Odds Ratio 1 2 1 0.9771433 NA 0.9557738 0.9989905 2 swe 1 2 1 0.0066171 0.0033631 0.0000255 0.0132087 1 Odds Ratio 1 2 1 1.0066391 NA 1.0000255 1.0132964 2 ptch_fr - Douglas-Fir:Lodegepole Pine 3 1 NA -1.0070476 0.1678850 -1.3360962 -0.6779989 1 Odds Ratio 3 1 NA 0.3652959 NA 0.2628699 0.5076318 2 ptch_fr - Fir-Spruce:Lodegepole Pine 3 2 NA -1.7507298 0.0965441 -1.9399528 -1.5615067 1 Odds Ratio 3 2 NA 0.1736472 NA 0.1437107 0.2098197 2 # model summary IQR odds ratio kable(summary(log_model)) Low High Diff. Effect S.E. Lower 0.95 Upper 0.95 Type area_perim_rat 30.2720666 51.63825 21.3661845 -0.1498333 0.0406101 -0.2294278 -0.0702389 1 Odds Ratio 30.2720666 51.63825 21.3661845 0.8608514 NA 0.7949884 0.9321711 2 patch_area 3.4162000 18.02035 14.6041500 -0.0014748 0.0009535 -0.0033436 0.0003941 1 Odds Ratio 3.4162000 18.02035 14.6041500 0.9985263 NA 0.9966619 1.0003941 2 elevation 2267.6879272 2596.66858 328.9806519 -1.0189136 0.0673432 -1.1509039 -0.8869232 1 Odds Ratio 2267.6879272 2596.66858 328.9806519 0.3609869 NA 0.3163507 0.4119212 2 slope 6.4809246 19.04767 12.5667448 -1.2474982 0.0867838 -1.4175912 -1.0774051 1 Odds Ratio 6.4809246 19.04767 12.5667448 0.2872225 NA 0.2422970 0.3404779 2 aspect -0.0472176 0.04535 0.0925676 -0.0160868 0.0442897 -0.1028930 0.0707195 1 Odds Ratio -0.0472176 0.04535 0.0925676 0.9840419 NA 0.9022235 1.0732801 2 def 17.7711926 22.01667 4.2454738 -0.0981639 0.0478967 -0.1920396 -0.0042882 1 Odds Ratio 17.7711926 22.01667 4.2454738 0.9065003 NA 0.8252742 0.9957210 2 swe 66.4833298 89.78611 23.3027802 0.1541975 0.0783702 0.0005946 0.3078003 1 Odds Ratio 66.4833298 89.78611 23.3027802 1.1667212 NA 1.0005948 1.3604293 2 ptch_fr - Douglas-Fir:Lodegepole Pine 3.0000000 1.00000 NA -1.0070476 0.1678850 -1.3360962 -0.6779989 1 Odds Ratio 3.0000000 1.00000 NA 0.3652959 NA 0.2628699 0.5076318 2 ptch_fr - Fir-Spruce:Lodegepole Pine 3.0000000 2.00000 NA -1.7507298 0.0965441 -1.9399528 -1.5615067 1 Odds Ratio 3.0000000 2.00000 NA 0.1736472 NA 0.1437107 0.2098197 2 15.3.3 Odds Ratio Table # bring in odds ratio table odds_table &lt;- read_csv(&quot;data/recovery/oddsratios_lrm.csv&quot;) %&gt;% dplyr::select(1:8) # function to show data to correct number of digits fun &lt;- function(x) {formatC(x, format = &quot;f&quot;, digits = 3)} # create table odds &lt;- nice_table(odds_table, separate.header = TRUE,width = 1,col.format.custom = c(3,5),format.custom = &quot;fun&quot;) # export to word # flextable::save_as_docx(odds, path = &quot;data/recovery/odds_table.docx&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
